local LolSenseUI = {}

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local function create(className, props)
    local obj = Instance.new(className)
    for k, v in pairs(props) do
        if k ~= "Parent" then
            obj[k] = v
        end
    end
    obj.Parent = props.Parent
    return obj
end

function LolSenseUI.new(config)
    config = config or {}
    
    local self = setmetatable({}, {__index = LolSenseUI})
    
    self.config = {
        name = config.name or "LOLSENSE",
        size = config.size or UDim2.new(0, 900, 0, 480),
        position = config.position or UDim2.new(0.5, -450, 0.14, -21),
        toggleKey = config.toggleKey or Enum.KeyCode.Insert
    }
    
    self.elements = {}
    self.tabs = {}
    self.currentTab = nil
    self.configs = {}
    self.destroyed = false
    
    self:CreateGUI()
    self:SetupDragging()
    self:BindToggleKey()
    
    return self
end

function LolSenseUI:CreateGUI()
    if self.destroyed then return end
    
    self.gui = create("ScreenGui", {
        Name = "ProtectedGUI",
        Parent = Players.LocalPlayer:WaitForChild("PlayerGui")
    })
    
    self.mainFrame = create("Frame", {
        Name = "MainFrame",
        Parent = self.gui,
        BackgroundColor3 = Color3.fromRGB(18, 18, 18),
        BorderSizePixel = 0,
        Position = self.config.position,
        Size = self.config.size
    })
    
    create("UICorner", {Parent = self.mainFrame})
    
    self.topBar = create("Frame", {
        Name = "TopBar",
        Parent = self.mainFrame,
        BackgroundTransparency = 1.000,
        Size = UDim2.new(1, 0, 0, 56)
    })
    
    self.title = create("TextLabel", {
        Name = "Title",
        Parent = self.topBar,
        BackgroundTransparency = 1.000,
        Position = UDim2.new(0, 10, 0, 0),
        Size = UDim2.new(0.167777777, 0, 1.23214304, 0),
        Font = Enum.Font.GothamBold,
        Text = self.config.name,
        TextColor3 = Color3.fromRGB(235, 235, 235),
        TextScaled = true,
        TextSize = 22.000,
        TextWrapped = true,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    self.leftPanel = create("Frame", {
        Name = "LeftPanel",
        Parent = self.mainFrame,
        BackgroundColor3 = Color3.fromRGB(12, 12, 12),
        Position = UDim2.new(0, 12, 0, 65),
        Size = UDim2.new(0, 320, 0, 480 - 72)
    })
    
    create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = self.leftPanel})
    
    self.rightPanel = create("Frame", {
        Name = "RightPanel",
        Parent = self.mainFrame,
        BackgroundColor3 = Color3.fromRGB(8, 8, 8),
        Position = UDim2.new(0, 340, 0, 6),
        Size = UDim2.new(1, -356, 1, -12)
    })
    
    create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = self.rightPanel})
end

function LolSenseUI:AddTab(name, displayName)
    if self.destroyed then return end
    
    local tabId = #self.tabs + 1
    
    local tabButton = create("TextButton", {
        Name = "Tab_" .. name,
        Parent = self.leftPanel,
        BackgroundColor3 = Color3.fromRGB(18, 12, 20),
        Position = UDim2.new(0, 10, 0, 10 + (44 * (tabId - 1))),
        Size = UDim2.new(1, -20, 0, 36),
        Font = Enum.Font.Gotham,
        Text = displayName or name,
        TextColor3 = Color3.fromRGB(200, 200, 200),
        TextSize = 15.000,
        AutoButtonColor = false
    })
    
    create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = tabButton})
    
    local tabContent = create("Frame", {
        Name = "Page_" .. name,
        Parent = self.rightPanel,
        BackgroundTransparency = 1.000,
        Position = UDim2.new(0, 10, 0, 10),
        Size = UDim2.new(1, -20, 1, -20),
        Visible = false
    })
    
    local title = create("TextLabel", {
        Name = "Title",
        Parent = tabContent,
        BackgroundTransparency = 1.000,
        Position = UDim2.new(0, -2, 0, -4),
        Size = UDim2.new(0.102157213, 0, 0.0546148047, 0),
        Font = Enum.Font.GothamBold,
        Text = displayName or name,
        TextColor3 = Color3.fromRGB(235, 235, 235),
        TextScaled = true,
        TextSize = 22.000,
        TextWrapped = true,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local scrollFrame = create("ScrollingFrame", {
        Parent = tabContent,
        BackgroundColor3 = Color3.fromRGB(8, 8, 8),
        Position = UDim2.new(0, 0, 0.06, 0),
        Size = UDim2.new(1, 0, 0.94, 0),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 2
    })
    
    create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = scrollFrame})
    
    self.tabs[name] = {
        button = tabButton,
        content = tabContent,
        scroll = scrollFrame,
        elements = {},
        yOffset = 10
    }
    
    if tabId == 1 then
        self:SwitchTab(name)
    end
    
    tabButton.MouseButton1Click:Connect(function()
        if self.destroyed then return end
        self:SwitchTab(name)
    end)
    
    tabButton.MouseEnter:Connect(function()
        if self.destroyed then return end
        if self.currentTab ~= name then
            tabButton.BackgroundColor3 = Color3.fromRGB(22, 15, 25)
        end
    end)
    
    tabButton.MouseLeave:Connect(function()
        if self.destroyed then return end
        if self.currentTab ~= name then
            tabButton.BackgroundColor3 = Color3.fromRGB(18, 12, 20)
        end
    end)
    
    return scrollFrame
end

function LolSenseUI:SwitchTab(tabName)
    if self.destroyed then return end
    
    for name, tab in pairs(self.tabs) do
        if name == tabName then
            tab.content.Visible = true
            tab.button.BackgroundColor3 = Color3.fromRGB(25, 18, 30)
            
            -- Анимация появления
            tab.content.Position = UDim2.new(1, 0, 0, 10)
            TweenService:Create(tab.content, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Position = UDim2.new(0, 10, 0, 10)
            }):Play()
        else
            tab.content.Visible = false
            tab.button.BackgroundColor3 = Color3.fromRGB(18, 12, 20)
        end
    end
    self.currentTab = tabName
end

function LolSenseUI:AddSection(parent, name)
    if self.destroyed then return end
    
    local section = create("Frame", {
        Parent = parent,
        BackgroundColor3 = Color3.fromRGB(12, 12, 12),
        Size = UDim2.new(1, -20, 0, 40),
        Position = UDim2.new(0, 10, 0, #parent:GetChildren() * 45)
    })
    
    create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = section})
    
    local label = create("TextLabel", {
        Parent = section,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Position = UDim2.new(0, 10, 0, 0),
        Text = name,
        TextColor3 = Color3.fromRGB(235, 235, 235),
        TextSize = 16,
        Font = Enum.Font.GothamBold,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    parent.CanvasSize = UDim2.new(0, 0, 0, parent.CanvasSize.Y.Offset + 50)
    
    return section
end

function LolSenseUI:AddToggle(name, defaultValue, callback)
    if self.destroyed or not self.currentTab then return end
    
    local tab = self.tabs[self.currentTab]
    local yPos = tab.yOffset
    
    local toggleFrame = create("Frame", {
        Parent = tab.scroll,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -20, 0, 30),
        Position = UDim2.new(0, 10, 0, yPos)
    })
    
    local label = create("TextLabel", {
        Parent = toggleFrame,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.7, 0, 1, 0),
        Text = name,
        TextColor3 = Color3.fromRGB(200, 200, 200),
        TextSize = 14,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local toggleButton = create("TextButton", {
        Parent = toggleFrame,
        Size = UDim2.new(0, 40, 0, 20),
        Position = UDim2.new(0.8, 0, 0.5, -10),
        BackgroundColor3 = Color3.fromRGB(60, 60, 60),
        BorderSizePixel = 0,
        Text = "",
        AutoButtonColor = false
    })
    
    create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = toggleButton})
    
    local toggleInner = create("Frame", {
        Parent = toggleButton,
        Size = UDim2.new(0, 16, 0, 16),
        Position = UDim2.new(0, 2, 0.5, -8),
        BackgroundColor3 = defaultValue and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(120, 120, 120),
        BorderSizePixel = 0
    })
    
    create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = toggleInner})
    
    local state = defaultValue
    
    local function updateToggle()
        if self.destroyed then return end
        local targetPos = state and UDim2.new(0, 22, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
        local targetColor = state and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(120, 120, 120)
        
        TweenService:Create(toggleInner, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Position = targetPos,
            BackgroundColor3 = targetColor
        }):Play()
    end
    
    toggleButton.MouseButton1Click:Connect(function()
        if self.destroyed then return end
        state = not state
        updateToggle()
        if callback then callback(state) end
    end)
    
    updateToggle()
    tab.yOffset = yPos + 35
    tab.scroll.CanvasSize = UDim2.new(0, 0, 0, tab.yOffset)
    
    local toggleObj = {
        GetState = function() return state end,
        SetState = function(value)
            if self.destroyed then return end
            state = value
            updateToggle()
            if callback then callback(state) end
        end
    }
    
    table.insert(tab.elements, toggleObj)
    return toggleObj
end

function LolSenseUI:AddSlider(name, min, max, default, callback)
    if self.destroyed or not self.currentTab then return end
    
    local tab = self.tabs[self.currentTab]
    local yPos = tab.yOffset
    
    local sliderFrame = create("Frame", {
        Parent = tab.scroll,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -20, 0, 50),
        Position = UDim2.new(0, 10, 0, yPos)
    })
    
    local label = create("TextLabel", {
        Parent = sliderFrame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 20),
        Text = name .. ": " .. default,
        TextColor3 = Color3.fromRGB(200, 200, 200),
        TextSize = 14,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local sliderBg = create("TextButton", {
        Parent = sliderFrame,
        Size = UDim2.new(1, 0, 0, 6),
        Position = UDim2.new(0, 0, 0, 30),
        BackgroundColor3 = Color3.fromRGB(60, 60, 60),
        BorderSizePixel = 0,
        Text = "",
        AutoButtonColor = false
    })
    
    create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = sliderBg})
    
    local sliderFill = create("Frame", {
        Parent = sliderBg,
        Size = UDim2.new((default - min) / (max - min), 0, 1, 0),
        BackgroundColor3 = Color3.fromRGB(0, 170, 255),
        BorderSizePixel = 0
    })
    
    create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = sliderFill})
    
    local sliderButton = create("TextButton", {
        Parent = sliderFill,
        Size = UDim2.new(0, 12, 0, 12),
        Position = UDim2.new(1, -6, 0.5, -6),
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BorderSizePixel = 0,
        Text = ""
    })
    
    create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = sliderButton})
    
    local value = default
    local dragging = false
    
    local function updateSlider(val)
        if self.destroyed then return end
        value = math.clamp(math.floor(val), min, max)
        local fill = (value - min) / (max - min)
        
        TweenService:Create(sliderFill, TweenInfo.new(0.1), {
            Size = UDim2.new(fill, 0, 1, 0)
        }):Play()
        
        label.Text = name .. ": " .. value
        if callback then callback(value) end
    end
    
    local function onInput(input)
        if self.destroyed then return end
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
        end
    end
    
    local function onInputEnd(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end
    
    sliderBg.InputBegan:Connect(onInput)
    sliderBg.InputEnded:Connect(onInputEnd)
    sliderButton.InputBegan:Connect(onInput)
    sliderButton.InputEnded:Connect(onInputEnd)
    
    local connection
    connection = UserInputService.InputChanged:Connect(function(input)
        if self.destroyed then
            connection:Disconnect()
            return
        end
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local mouse = UserInputService:GetMouseLocation()
            local absPos = sliderBg.AbsolutePosition
            local absSize = sliderBg.AbsoluteSize
            local relX = math.clamp((mouse.X - absPos.X) / absSize.X, 0, 1)
            updateSlider(min + (relX * (max - min)))
        end
    end)
    
    tab.yOffset = yPos + 55
    tab.scroll.CanvasSize = UDim2.new(0, 0, 0, tab.yOffset)
    
    local sliderObj = {
        GetValue = function() return value end,
        SetValue = function(val) 
            if self.destroyed then return end
            updateSlider(val) 
        end
    }
    
    table.insert(tab.elements, sliderObj)
    return sliderObj
end

function LolSenseUI:AddDropdown(name, options, defaultIndex, callback)
    if self.destroyed or not self.currentTab then return end
    
    local tab = self.tabs[self.currentTab]
    local yPos = tab.yOffset
    
    local dropdownFrame = create("Frame", {
        Parent = tab.scroll,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -20, 0, 30),
        Position = UDim2.new(0, 10, 0, yPos)
    })
    
    local label = create("TextLabel", {
        Parent = dropdownFrame,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.5, 0, 1, 0),
        Text = name,
        TextColor3 = Color3.fromRGB(200, 200, 200),
        TextSize = 14,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local dropdownButton = create("TextButton", {
        Parent = dropdownFrame,
        Size = UDim2.new(0.45, 0, 1, 0),
        Position = UDim2.new(0.55, 0, 0, 0),
        BackgroundColor3 = Color3.fromRGB(40, 40, 40),
        Text = options[defaultIndex] or "Select...",
        TextColor3 = Color3.fromRGB(200, 200, 200),
        TextSize = 12,
        Font = Enum.Font.Gotham,
        AutoButtonColor = false
    })
    
    create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = dropdownButton})
    
    local dropdownContent = create("Frame", {
        Parent = dropdownFrame,
        BackgroundColor3 = Color3.fromRGB(30, 30, 30),
        Size = UDim2.new(0.45, 0, 0, 0),
        Position = UDim2.new(0.55, 0, 1, 5),
        Visible = false,
        ClipsDescendants = true,
        ZIndex = 10
    })
    
    create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = dropdownContent})
    
    local dropdownOpen = false
    local selectedIndex = defaultIndex
    
    local function toggleDropdown()
        if self.destroyed then return end
        dropdownOpen = not dropdownOpen
        
        if dropdownOpen then
            dropdownContent.Visible = true
            TweenService:Create(dropdownContent, TweenInfo.new(0.2), {
                Size = UDim2.new(0.45, 0, 0, math.min(#options * 25, 150))
            }):Play()
        else
            TweenService:Create(dropdownContent, TweenInfo.new(0.2), {
                Size = UDim2.new(0.45, 0, 0, 0)
            }):Play()
            wait(0.2)
            dropdownContent.Visible = false
        end
    end
    
    local function selectOption(index, value)
        if self.destroyed then return end
        selectedIndex = index
        dropdownButton.Text = value
        toggleDropdown()
        if callback then callback(index, value) end
    end
    
    -- Создаем опции
    for i, option in ipairs(options) do
        local optionButton = create("TextButton", {
            Parent = dropdownContent,
            Size = UDim2.new(1, 0, 0, 25),
            Position = UDim2.new(0, 0, 0, (i-1)*25),
            BackgroundColor3 = i == defaultIndex and Color3.fromRGB(50, 50, 70) or Color3.fromRGB(40, 40, 40),
            Text = option,
            TextColor3 = Color3.fromRGB(200, 200, 200),
            TextSize = 12,
            Font = Enum.Font.Gotham,
            AutoButtonColor = false,
            ZIndex = 11
        })
        
        optionButton.MouseButton1Click:Connect(function()
            selectOption(i, option)
        end)
        
        optionButton.MouseEnter:Connect(function()
            if self.destroyed then return end
            if i ~= selectedIndex then
                optionButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
            end
        end)
        
        optionButton.MouseLeave:Connect(function()
            if self.destroyed then return end
            if i ~= selectedIndex then
                optionButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            end
        end)
    end
    
    dropdownButton.MouseButton1Click:Connect(toggleDropdown)
    
    -- Закрываем dropdown при клике вне его
    local dropdownConnection
    dropdownConnection = UserInputService.InputBegan:Connect(function(input)
        if self.destroyed then
            dropdownConnection:Disconnect()
            return
        end
        if dropdownOpen and input.UserInputType == Enum.UserInputType.MouseButton1 then
            local mousePos = UserInputService:GetMouseLocation()
            local absPos = dropdownContent.AbsolutePosition
            local absSize = dropdownContent.AbsoluteSize
            
            if not (mousePos.X >= absPos.X and mousePos.X <= absPos.X + absSize.X and
                   mousePos.Y >= absPos.Y and mousePos.Y <= absPos.Y + absSize.Y) then
                toggleDropdown()
            end
        end
    end)
    
    tab.yOffset = yPos + 35
    tab.scroll.CanvasSize = UDim2.new(0, 0, 0, tab.yOffset)
    
    local dropdownObj = {
        GetValue = function() return selectedIndex end,
        SetValue = function(index)
            if self.destroyed then return end
            if options[index] then
                selectedIndex = index
                dropdownButton.Text = options[index]
                if callback then callback(index, options[index]) end
            end
        end
    }
    
    table.insert(tab.elements, dropdownObj)
    return dropdownObj
end

function LolSenseUI:AddColorPicker(name, defaultColor, callback)
    if self.destroyed or not self.currentTab then return end
    
    local tab = self.tabs[self.currentTab]
    local yPos = tab.yOffset
    
    local colorFrame = create("Frame", {
        Parent = tab.scroll,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -20, 0, 30),
        Position = UDim2.new(0, 10, 0, yPos)
    })
    
    local label = create("TextLabel", {
        Parent = colorFrame,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.7, 0, 1, 0),
        Text = name,
        TextColor3 = Color3.fromRGB(200, 200, 200),
        TextSize = 14,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local colorButton = create("TextButton", {
        Parent = colorFrame,
        Size = UDim2.new(0, 40, 0, 20),
        Position = UDim2.new(0.8, 0, 0.5, -10),
        BackgroundColor3 = defaultColor,
        BorderSizePixel = 0,
        Text = "",
        AutoButtonColor = false
    })
    
    create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = colorButton})
    
    -- Gradient effect
    local gradient = create("UIGradient", {
        Parent = colorButton,
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, defaultColor),
            ColorSequenceKeypoint.new(1, Color3.new(1, 1, 1))
        }),
        Rotation = 45
    })
    
    local currentColor = defaultColor
    
    colorButton.MouseButton1Click:Connect(function()
        if self.destroyed then return end
        -- Здесь можно реализовать полноценный color picker
        local newColor = Color3.fromHSV(math.random(), 1, 1)
        currentColor = newColor
        colorButton.BackgroundColor3 = newColor
        gradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, newColor),
            ColorSequenceKeypoint.new(1, Color3.new(1, 1, 1))
        })
        if callback then callback(newColor) end
    end)
    
    tab.yOffset = yPos + 35
    tab.scroll.CanvasSize = UDim2.new(0, 0, 0, tab.yOffset)
    
    local colorObj = {
        GetColor = function() return currentColor end,
        SetColor = function(color)
            if self.destroyed then return end
            currentColor = color
            colorButton.BackgroundColor3 = color
            gradient.Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, color),
                ColorSequenceKeypoint.new(1, Color3.new(1, 1, 1))
            })
            if callback then callback(color) end
        end
    }
    
    table.insert(tab.elements, colorObj)
    return colorObj
end

function LolSenseUI:AddTextBox(name, defaultText, callback)
    if self.destroyed or not self.currentTab then return end
    
    local tab = self.tabs[self.currentTab]
    local yPos = tab.yOffset
    
    local textFrame = create("Frame", {
        Parent = tab.scroll,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -20, 0, 40),
        Position = UDim2.new(0, 10, 0, yPos)
    })
    
    local label = create("TextLabel", {
        Parent = textFrame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 20),
        Text = name,
        TextColor3 = Color3.fromRGB(200, 200, 200),
        TextSize = 14,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local textBox = create("TextBox", {
        Parent = textFrame,
        Size = UDim2.new(1, 0, 0, 25),
        Position = UDim2.new(0, 0, 0, 20),
        BackgroundColor3 = Color3.fromRGB(40, 40, 40),
        TextColor3 = Color3.fromRGB(255, 255, 255),
        Text = defaultText or "",
        TextSize = 14,
        Font = Enum.Font.Gotham,
        PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
    })
    
    create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = textBox})
    
    textBox.FocusLost:Connect(function()
        if self.destroyed then return end
        if callback then callback(textBox.Text) end
    end)
    
    tab.yOffset = yPos + 45
    tab.scroll.CanvasSize = UDim2.new(0, 0, 0, tab.yOffset)
    
    local textObj = {
        GetText = function() return textBox.Text end,
        SetText = function(text) 
            if self.destroyed then return end
            textBox.Text = text 
        end
    }
    
    table.insert(tab.elements, textObj)
    return textObj
end

function LolSenseUI:AddButton(name, callback)
    if self.destroyed or not self.currentTab then return end
    
    local tab = self.tabs[self.currentTab]
    local yPos = tab.yOffset
    
    local button = create("TextButton", {
        Parent = tab.scroll,
        Size = UDim2.new(1, -20, 0, 36),
        Position = UDim2.new(0, 10, 0, yPos),
        BackgroundColor3 = Color3.fromRGB(18, 12, 20),
        Text = name,
        TextColor3 = Color3.fromRGB(200, 200, 200),
        TextSize = 15,
        Font = Enum.Font.Gotham,
        AutoButtonColor = false
    })
    
    create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = button})
    
    button.MouseButton1Click:Connect(function()
        if self.destroyed then return end
        if callback then callback() end
    end)
    
    button.MouseEnter:Connect(function()
        if self.destroyed then return end
        button.BackgroundColor3 = Color3.fromRGB(25, 18, 28)
    end)
    
    button.MouseLeave:Connect(function()
        if self.destroyed then return end
        button.BackgroundColor3 = Color3.fromRGB(18, 12, 20)
    end)
    
    tab.yOffset = yPos + 41
    tab.scroll.CanvasSize = UDim2.new(0, 0, 0, tab.yOffset)
    
    return button
end

function LolSenseUI:AddConfigSystem()
    if self.destroyed then return end
    
    local configTab = self:AddTab("Config", "Config")
    self:SwitchTab("Config")
    
    -- Config controls (левая часть)
    local controlsFrame = create("Frame", {
        Parent = configTab,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 40),
        Size = UDim2.new(0.3, -20, 0, 300)
    })
    
    -- TextBox для имени конфига
    local textBoxFrame = create("Frame", {
        Parent = controlsFrame,
        BackgroundColor3 = Color3.fromRGB(18, 12, 20),
        Size = UDim2.new(1, 0, 0, 35),
        Position = UDim2.new(0, 0, 0, 0)
    })
    
    create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = textBoxFrame})
    
    local configTextBox = create("TextBox", {
        Parent = textBoxFrame,
        Size = UDim2.new(1, -20, 1, -10),
        Position = UDim2.new(0, 10, 0, 5),
        BackgroundTransparency = 1,
        TextColor3 = Color3.fromRGB(255, 255, 255),
        Text = "",
        TextSize = 14,
        Font = Enum.Font.Gotham,
        PlaceholderColor3 = Color3.fromRGB(150, 150, 150),
        PlaceholderText = "Config name..."
    })
    
    -- Кнопки управления конфигами
    local loadBtn = create("TextButton", {
        Parent = controlsFrame,
        Size = UDim2.new(1, 0, 0, 36),
        Position = UDim2.new(0, 0, 0, 50),
        BackgroundColor3 = Color3.fromRGB(18, 12, 20),
        Text = "Load",
        TextColor3 = Color3.fromRGB(200, 200, 200),
        TextSize = 15,
        Font = Enum.Font.Gotham,
        AutoButtonColor = false
    })
    
    create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = loadBtn})
    
    local saveBtn = create("TextButton", {
        Parent = controlsFrame,
        Size = UDim2.new(1, 0, 0, 36),
        Position = UDim2.new(0, 0, 0, 91),
        BackgroundColor3 = Color3.fromRGB(18, 12, 20),
        Text = "Save",
        TextColor3 = Color3.fromRGB(200, 200, 200),
        TextSize = 15,
        Font = Enum.Font.Gotham,
        AutoButtonColor = false
    })
    
    create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = saveBtn})
    
    local deleteBtn = create("TextButton", {
        Parent = controlsFrame,
        Size = UDim2.new(1, 0, 0, 36),
        Position = UDim2.new(0, 0, 0, 132),
        BackgroundColor3 = Color3.fromRGB(18, 12, 20),
        Text = "Delete",
        TextColor3 = Color3.fromRGB(200, 200, 200),
        TextSize = 15,
        Font = Enum.Font.Gotham,
        AutoButtonColor = false
    })
    
    create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = deleteBtn})
    
    -- Config list (правая часть)
    local configList = create("ScrollingFrame", {
        Parent = configTab,
        BackgroundColor3 = Color3.fromRGB(8, 8, 8),
        Position = UDim2.new(0.35, 0, 0, 40),
        Size = UDim2.new(0.65, -20, 0, 300),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 2
    })
    
    create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = configList})
    
    -- Обработчики кнопок
    saveBtn.MouseButton1Click:Connect(function()
        if self.destroyed then return end
        local configName = configTextBox.Text
        if configName and configName ~= "" then
            self:SaveConfig(configName)
            self:UpdateConfigList(configList)
        end
    end)
    
    loadBtn.MouseButton1Click:Connect(function()
        if self.destroyed then return end
        local configName = configTextBox.Text
        if configName and configName ~= "" then
            self:LoadConfig(configName)
        end
    end)
    
    deleteBtn.MouseButton1Click:Connect(function()
        if self.destroyed then return end
        local configName = configTextBox.Text
        if configName and configName ~= "" then
            self:DeleteConfig(configName)
            self:UpdateConfigList(configList)
        end
    end)
    
    -- Стилизация кнопок
    local function styleButton(btn)
        btn.MouseEnter:Connect(function()
            if self.destroyed then return end
            btn.BackgroundColor3 = Color3.fromRGB(25, 18, 28)
        end)
        
        btn.MouseLeave:Connect(function()
            if self.destroyed then return end
            btn.BackgroundColor3 = Color3.fromRGB(18, 12, 20)
        end)
    end
    
    styleButton(loadBtn)
    styleButton(saveBtn)
    styleButton(deleteBtn)
    
    -- Заполняем список конфигов
    self:UpdateConfigList(configList)
end

function LolSenseUI:UpdateConfigList(configList)
    if self.destroyed then return end
    
    -- Очищаем список
    for _, child in ipairs(configList:GetChildren()) do
        if child:IsA("Frame") then
            child:Destroy()
        end
    end
    
    local configNames = {}
    for name, _ in pairs(self.configs) do
        table.insert(configNames, name)
    end
    
    -- Сортируем имена конфигов
    table.sort(configNames)
    
    local yOffset = 0
    for _, configName in ipairs(configNames) do
        local configItem = create("TextButton", {
            Parent = configList,
            BackgroundColor3 = Color3.fromRGB(8, 8, 8),
            Size = UDim2.new(1, -10, 0, 31),
            Position = UDim2.new(0, 5, 0, yOffset),
            Text = "",
            AutoButtonColor = false
        })
        
        create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = configItem})
        
        local nameLabel = create("TextLabel", {
            Parent = configItem,
            BackgroundTransparency = 1,
            Size = UDim2.new(0.156742349, 0, 1, 0),
            Position = UDim2.new(0, 0, 0, 1),
            Text = configName,
            TextColor3 = Color3.fromRGB(235, 235, 235),
            TextSize = 16,
            Font = Enum.Font.GothamBold,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        
        local authorLabel = create("TextLabel", {
            Parent = configItem,
            BackgroundTransparency = 1,
            Size = UDim2.new(0.442768693, 0, 1, 0),
            Position = UDim2.new(0, 103, 0, 1),
            Text = "Author: " .. Players.LocalPlayer.Name,
            TextColor3 = Color3.fromRGB(235, 235, 235),
            TextSize = 14,
            Font = Enum.Font.GothamBold,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        
        local dateLabel = create("TextLabel", {
            Parent = configItem,
            BackgroundTransparency = 1,
            Size = UDim2.new(0.283379972, 0, 1, 0),
            Position = UDim2.new(0, 328, 0, 1),
            Text = os.date("%d/%m/%Y"),
            TextColor3 = Color3.fromRGB(235, 235, 235),
            TextSize = 14,
            Font = Enum.Font.GothamBold,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        
        configItem.MouseButton1Click:Connect(function()
            if self.destroyed then return end
            -- Находим TextBox
            local textBox = configList.Parent:FindFirstChildWhichIsA("TextBox")
            if textBox then
                textBox.Text = configName
            end
        end)
        
        configItem.MouseEnter:Connect(function()
            if self.destroyed then return end
            configItem.BackgroundColor3 = Color3.fromRGB(12, 12, 12)
        end)
        
        configItem.MouseLeave:Connect(function()
            if self.destroyed then return end
            configItem.BackgroundColor3 = Color3.fromRGB(8, 8, 8)
        end)
        
        yOffset = yOffset + 36
    end
    
    configList.CanvasSize = UDim2.new(0, 0, 0, yOffset)
end

function LolSenseUI:SaveConfig(name)
    if self.destroyed then return end
    
    local configData = {}
    for tabName, tab in pairs(self.tabs) do
        configData[tabName] = {}
        for i, element in pairs(tab.elements) do
            if element.GetState then
                configData[tabName][i] = element.GetState()
            elseif element.GetValue then
                configData[tabName][i] = element.GetValue()
            elseif element.GetColor then
                local color = element.GetColor()
                configData[tabName][i] = {color.R, color.G, color.B}
            elseif element.GetText then
                configData[tabName][i] = element.GetText()
            end
        end
    end
    self.configs[name] = configData
    print("Config saved:", name)
end

function LolSenseUI:LoadConfig(name)
    if self.destroyed then return end
    
    if self.configs[name] then
        for tabName, tabData in pairs(self.configs[name]) do
            if self.tabs[tabName] then
                for i, value in pairs(tabData) do
                    local element = self.tabs[tabName].elements[i]
                    if element then
                        if element.SetState then
                            element.SetState(value)
                        elseif element.SetValue then
                            element.SetValue(value)
                        elseif element.SetColor then
                            element.SetColor(Color3.new(value[1], value[2], value[3]))
                        elseif element.SetText then
                            element.SetText(value)
                        end
                    end
                end
            end
        end
        print("Config loaded:", name)
    else
        print("Config not found:", name)
    end
end

function LolSenseUI:DeleteConfig(name)
    if self.destroyed then return end
    self.configs[name] = nil
    print("Config deleted:", name)
end

function LolSenseUI:SetupDragging()
    local dragging = false
    local dragStart, startPos

    self.topBar.InputBegan:Connect(function(input)
        if self.destroyed then return end
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = self.mainFrame.Position
        end
    end)

    self.topBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)

    local connection
    connection = UserInputService.InputChanged:Connect(function(input)
        if self.destroyed then
            connection:Disconnect()
            return
        end
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            self.mainFrame.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
end

function LolSenseUI:BindToggleKey()
    local connection
    connection = UserInputService.InputBegan:Connect(function(input, processed)
        if self.destroyed then
            connection:Disconnect()
            return
        end
        if processed then return end
        if input.KeyCode == self.config.toggleKey then
            self:Toggle()
        end
    end)
end

function LolSenseUI:Toggle()
    if self.destroyed then return end
    self.mainFrame.Visible = not self.mainFrame.Visible
end

function LolSenseUI:Show()
    if self.destroyed then return end
    self.mainFrame.Visible = true
end

function LolSenseUI:Hide()
    if self.destroyed then return end
    self.mainFrame.Visible = false
end

function LolSenseUI:Destroy()
    if self.destroyed then return end
    self.destroyed = true
    if self.gui then
        self.gui:Destroy()
    end
end

return LolSenseUI
